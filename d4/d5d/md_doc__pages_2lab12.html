<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Microprocessor 2 Labs: Lab 12 UART and LEDC (PWM)</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../microprocessor_2_template.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../university_of_texas_at_el_paso_logo-2.png"/></td>
  <td id="projectalign">
   <div id="projectname">Microprocessor 2 Labs<span id="projectnumber">&#160;v2.0</span>
   </div>
   <div id="projectbrief">Microprocessor 2 Lab Documenation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<head>
  <html> 
  <head>
      <!-- ... other metadata & script includes ... -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript">
          DoxygenAwesomeDarkModeToggle.init()
      </script>
  </head>
  <body>
<html>
  <head>
      <!-- ... other metadata & script includes ... -->
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript">
          DoxygenAwesomeFragmentCopyButton.init()
      </script>
  </head>
  <body>
<html>
    <head>
      <a href="https://github.com/jminjares4/Microprocessor-2-Lab-Template" class="github-corner" title="View source on GitHub" target="_blank">
        <svg viewBox="0 0 250 250" width="50" height="50" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    </head>
    <body>
  <!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d4/d5d/md_doc__pages_2lab12.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Lab 12 UART and LEDC (PWM)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md126"></a> </p>
<h1><a class="anchor" id="autotoc_md127"></a>
Objective</h1>
<p>The objective for this lab is to understand how to use <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/gpio.html#"><code>Espressif</code></a> UART driver. Universal Asynchronous Receiver/Transmitter is a peripherl used to receive and send data, this protocol is a serial communication type. The ESP32 has three UART channels: <em><b>UART 0, UART 1, UART 2.</b></em> In this configuration we will use <em><b>UART 1</b></em> which allows you to select custom pins for the RX and TX setup. Students must receive information from the sender using UART and control the PWM peripheral to dim and brighten an LED to show LOW, MEDIUM and HIGH.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Tasks   </th><th class="markdownTableHeadLeft">Objective    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">UART TASK   </td><td class="markdownTableBodyLeft">Receive data and send through Queue    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PWM TASK   </td><td class="markdownTableBodyLeft">Receive Queue and change duty cycle   </td></tr>
</table>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">GPIO Pin   </th><th class="markdownTableHeadLeft">UART    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">5   </td><td class="markdownTableBodyLeft">TX    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">4   </td><td class="markdownTableBodyLeft">RX   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md128"></a>
Bonus</h1>
<ul>
<li>Undergrad Bonus<ul>
<li>Send the current state of the LED back to sender</li>
</ul>
</li>
<li>Grad Bonus<ul>
<li>Add another LED and send both LEDs' states back to the sender </li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md129"></a>
ESP32 Pinout</h2>
<div class="fragment"><div class="line">                                        +-----------------------+</div>
<div class="line">                                        | O      | USB |      O |</div>
<div class="line">                                        |        -------        |</div>
<div class="line">                                    3V3 | [ ]               [ ] | VIN</div>
<div class="line">                                    GND | [ ]               [ ] | GND</div>
<div class="line">    Touch3 / HSPI_CS0 / ADC2_3 / GPIO15 | [ ]               [ ] | GPIO13 / ADC2_4 / HSPI_ID / Touch4</div>
<div class="line">CS / Touch2 / HSPI_WP / ADC2_2 /  GPIO2 | [ ]               [ ] | GPIO12 / ADC2_5 / HSPI_Q / Touch5</div>
<div class="line">     Touch0 / HSPI_HD / ADC2_0 /  GPIO4 | [ ]               [ ] | GPIO14 / ADC2_6 / HSPI_CLK / Touch6</div>
<div class="line">                        U2_RXD / GPIO16 | [ ]               [ ] | GPIO27 / ADC2_7 / Touch7</div>
<div class="line">                        U2_TXD / GPIO17 | [ ]               [ ] | GPIO26 / ADC2_9 / DAC2</div>
<div class="line">                     V_SPI_CS0 /  GPIO5 | [ ]  ___________  [ ] | GPIO25 / ADC2_8 / DAC1</div>
<div class="line">               SCK / V_SPI_CLK / GPIO18 | [ ] |           | [ ] | GPIO33 / ADC1_5 / Touch8 / XTAL32</div>
<div class="line">       U0_CTS / MSIO / V_SPI_Q / GPIO19 | [ ] |           | [ ] | GPIO32 / ADC1_4 / Touch9 / XTAL32</div>
<div class="line">                SDA / V_SPI_HD / GPIO21 | [ ] |           | [ ] | GPIO35 / ADC1_7 </div>
<div class="line">                 CLK2 / U0_RXD /  GPIO3 | [ ] |           | [ ] | GPIO34 / ADC1_6 </div>
<div class="line">                 CLK3 / U0_TXD /  GPIO1 | [ ] |           | [ ] | GPIO39 / ADC1_3 / SensVN </div>
<div class="line">       SCL / U0_RTS / V_SPI_WP / GPIO22 | [ ] |           | [ ] | GPIO36 / ADC1_0 / SensVP </div>
<div class="line">               MOSI / V_SPI_WP / GPIO23 | [ ] |___________| [ ] | EN </div>
<div class="line">                                        |                       |</div>
<div class="line">                                        |  |  |  ____  ____  |  |</div>
<div class="line">                                        |  |  |  |  |  |  |  |  |</div>
<div class="line">                                        |  |__|__|  |__|  |__|  |</div>
<div class="line">                                        | O                   O |</div>
<div class="line">                                        +-----------------------+</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md130"></a>
Example</h2>
<p>Here is an example of a UART receiving data and printing Hello World.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;freertos/FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/task.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/uart.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/queue.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;driver/ledc.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/queue.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define UART_NUM        UART_NUM_2</span></div>
<div class="line"><span class="preprocessor">#define BUF_SIZE        1024</span></div>
<div class="line"><span class="preprocessor">#define TASK_MEMORY     1024 </span></div>
<div class="line"><span class="preprocessor">#define ONBOARD_LED       2</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> uart_init()</div>
<div class="line">{</div>
<div class="line">    uart_config_t uart_config = {</div>
<div class="line">    .baud_rate = 9600,</div>
<div class="line">    .data_bits = UART_DATA_8_BITS,</div>
<div class="line">    .parity    = UART_PARITY_DISABLE,</div>
<div class="line">    .stop_bits = UART_STOP_BITS_1,</div>
<div class="line">    .flow_ctrl = UART_HW_FLOWCTRL_DISABLE,</div>
<div class="line">    .source_clk = UART_SCLK_APB,</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Installing UART Driver, Setting Pins and Configuration */</span></div>
<div class="line">    uart_param_config(<a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a49dcd593bb4dd55620e7c08581f8e2ad">UART_NUM</a>, &amp;uart_config);</div>
<div class="line">    uart_set_pin(<a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a49dcd593bb4dd55620e7c08581f8e2ad">UART_NUM</a>, 5, 4, UART_PIN_NO_CHANGE, UART_PIN_NO_CHANGE);</div>
<div class="line">    uart_driver_install(<a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a49dcd593bb4dd55620e7c08581f8e2ad">UART_NUM</a>, <a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>, <a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>, 0, NULL, 0);</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> uart_task(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    uint8_t *data = (uint8_t *) malloc(<a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span>(1){</div>
<div class="line">    bzero(data,<a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> len = uart_read_bytes(<a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a49dcd593bb4dd55620e7c08581f8e2ad">UART_NUM</a>, data, <a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>, pdMS_TO_TICKS(100));</div>
<div class="line">    <span class="keywordtype">char</span>* send1_str = <span class="stringliteral">&quot;Onboard LED ON! &quot;</span>;</div>
<div class="line">    <span class="keywordtype">char</span>* send2_str = <span class="stringliteral">&quot;Onboard LED OFF! &quot;</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; len; i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">char</span> value = data[i];</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">switch</span> (value)</div>
<div class="line">            {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div>
<div class="line">                  printf(“Hello World”);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            </div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            </div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">        free(data);</div>
<div class="line"> </div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../dd/d74/_additional___labs_2_lab__10_2main_8c.html#abce06be17fc37d675118a678a8100a36">app_main</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    uart_init();</div>
<div class="line"> </div>
<div class="line">    xTaskCreate(uart_task, <span class="stringliteral">&quot;uart_task&quot;</span>, <a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#afb0dda7d617e2076f8ea7d0fc28984e2">TASK_MEMORY</a>, NULL, 5, NULL);</div>
<div class="line">}</div>
<div class="ttc" id="a_additional___labs_2_lab__10_2main_8c_html_abce06be17fc37d675118a678a8100a36"><div class="ttname"><a href="../../dd/d74/_additional___labs_2_lab__10_2main_8c.html#abce06be17fc37d675118a678a8100a36">app_main</a></div><div class="ttdeci">void app_main()</div><div class="ttdef"><b>Definition</b> main.c:316</div></div>
<div class="ttc" id="a_additional___labs_2_lab__12_2main_8c_html_a49dcd593bb4dd55620e7c08581f8e2ad"><div class="ttname"><a href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a49dcd593bb4dd55620e7c08581f8e2ad">UART_NUM</a></div><div class="ttdeci">#define UART_NUM</div><div class="ttdef"><b>Definition</b> main.c:10</div></div>
<div class="ttc" id="a_additional___labs_2_lab__12_2main_8c_html_a6821bafc3c88dfb2e433a095df9940c6"><div class="ttname"><a href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a></div><div class="ttdeci">#define BUF_SIZE</div><div class="ttdef"><b>Definition</b> main.c:11</div></div>
<div class="ttc" id="a_additional___labs_2_lab__12_2main_8c_html_afb0dda7d617e2076f8ea7d0fc28984e2"><div class="ttname"><a href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#afb0dda7d617e2076f8ea7d0fc28984e2">TASK_MEMORY</a></div><div class="ttdeci">#define TASK_MEMORY</div><div class="ttdef"><b>Definition</b> main.c:12</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md131"></a>
Lab Template</h2>
<p>Here is the Lab Template need for the completion of the Lab. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;freertos/FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/task.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/uart.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/queue.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;driver/ledc.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/queue.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define UART_NUM        UART_NUM_2</span></div>
<div class="line"><span class="preprocessor">#define BUF_SIZE        1024</span></div>
<div class="line"><span class="preprocessor">#define TASK_MEMORY     1024 </span></div>
<div class="line"> </div>
<div class="line">QueueHandle_t <a class="code hl_variable" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#ab603ca098576a789b1b97f491b994de4">LEDQueue</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> uart_init()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a5687d704551207929e6a5bab14b61f50">sledc_setup</a>(<span class="keywordtype">void</span>){</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#aedaa5a6c9f9ab4832e4a9cca5be5498a">LEDC_task</a>(<span class="keywordtype">void</span> *pvParameters)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> uart_task(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../dd/d74/_additional___labs_2_lab__10_2main_8c.html#abce06be17fc37d675118a678a8100a36">app_main</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    uart_init();</div>
<div class="line">    ledc_setup();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_variable" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#ab603ca098576a789b1b97f491b994de4">LEDQueue</a> = xQueueCreate(5, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"> </div>
<div class="line">    xTaskCreate(uart_task, <span class="stringliteral">&quot;uart_task&quot;</span>, <a class="code hl_define" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#afb0dda7d617e2076f8ea7d0fc28984e2">TASK_MEMORY</a>, NULL, 5, NULL);</div>
<div class="line">    xTaskCreate(<a class="code hl_function" href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#aedaa5a6c9f9ab4832e4a9cca5be5498a">LEDC_task</a>, <span class="stringliteral">&quot;LEDC_task&quot;</span>, 2048, NULL, 5, NULL);</div>
<div class="line">}</div>
<div class="ttc" id="a_additional___labs_2_lab__12_2main_8c_html_a5687d704551207929e6a5bab14b61f50"><div class="ttname"><a href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#a5687d704551207929e6a5bab14b61f50">sledc_setup</a></div><div class="ttdeci">void sledc_setup(void)</div><div class="ttdef"><b>Definition</b> main.c:21</div></div>
<div class="ttc" id="a_additional___labs_2_lab__12_2main_8c_html_ab603ca098576a789b1b97f491b994de4"><div class="ttname"><a href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#ab603ca098576a789b1b97f491b994de4">LEDQueue</a></div><div class="ttdeci">QueueHandle_t LEDQueue</div><div class="ttdef"><b>Definition</b> main.c:14</div></div>
<div class="ttc" id="a_additional___labs_2_lab__12_2main_8c_html_aedaa5a6c9f9ab4832e4a9cca5be5498a"><div class="ttname"><a href="../../d1/d29/_additional___labs_2_lab__12_2main_8c.html#aedaa5a6c9f9ab4832e4a9cca5be5498a">LEDC_task</a></div><div class="ttdeci">void LEDC_task(void *pvParameters)</div><div class="ttdef"><b>Definition</b> main.c:25</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md132"></a>
C Helpful Functions</h2>
<p>For this lab there are additional functions from <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/gpio.html#"><code>Espressif</code></a> that are important to use the UART peripheral. As previously mentioned, ESP32 has 3 UART channels. So to be able to send information through UART you need to use the uart_write_bytes() function, here is an example of how to use it from the <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/gpio.html#"><code>Espressif</code></a> documentation.</p>
<div class="fragment"><div class="line"><span class="comment">/* Write Data to UART. */</span></div>
<div class="line"><span class="keywordtype">char</span> * test_str = <span class="stringliteral">&quot;This is a test string.\n&quot;</span>;</div>
<div class="line">uart_write_bytes(uart_num, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)test_str, strlen(test_str));</div>
</div><!-- fragment --><p>UART peripheral also need functions to set up communication parameters uart_param_config() this function uses a uart_config_t data structure:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> uart_port_t uart_num = UART_NUM_2;</div>
<div class="line">uart_config_t uart_config = {</div>
<div class="line">    .baurd_rate = 115200,</div>
<div class="line">    .data_bits = UART_DATA_8_BITS,</div>
<div class="line">    .parity = UART_PARITY_DISABLE,</div>
<div class="line">    .stop_bits = UART_STOP_BITS_1,</div>
<div class="line">    .flow_ctrl = UART_HW_FLOWCTRL_CTS_RTS,</div>
<div class="line">    .rx_flow_ctrl_thresh = 122,</div>
<div class="line">};</div>
<div class="line"><span class="comment">/* Configure UART Parameters */</span></div>
<div class="line">ESP_ERROR_CHECK(uart_param_config(uart_num, &amp;uart_config));</div>
</div><!-- fragment --><p> To set communication pins use uart_set_pin(): </p><div class="fragment"><div class="line"><span class="comment">/* Set UART Pins (TX: IO4, RX:IO5 RTS: IO18, CTS: IO19) */</span></div>
<div class="line">ESP_ERROR_CHECK(uart_set_pin(UART_NUM_2,4,5,18,19));</div>
</div><!-- fragment --><p> Finally Driver Installation with uart_driver_install() to state size of TX buffer, size of RX buffer, Event Queue handle and size and Flags to allocate interrupt: </p><div class="fragment"><div class="line"><span class="comment">/* Setup UART buffered IO with Event Queue */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> uart_buffer_size = (1024 * 2);</div>
<div class="line">QueueHandle_t uart_queue;</div>
<div class="line"><span class="comment">/* Install UART Driver using an Event Queue*/</span></div>
<div class="line">ESP_ERROR_CHECK(uart_driver_install(UART_NUM_2, uart_buffer_size, uart_buffer_size, 10, &amp;uart_queue, 0));</div>
</div><!-- fragment --><p>To be able to complete this lab we will use an external hardware device that will help you communicate a serial writer software to the ESP32. The HC-05 Bluetooth module is to be connected to the ESP32 and paired to the user's PC Bluetooth. When connecting the HC-05 be sure to select the correct module and enter default password: 1234. It is important to open the Device Manager of your PC to see the name of the port in which the HC-05 module is connected to. To be able to send information the serial writer software must have the same configuration as the UART in the uart_config_t. There are a lot of serial write software out there but the recommened ones are Putty and Dock-light. Flow the Links below for more information about hardware and parity setup.</p>
<p><img src="../../Bluetooth_and_other_devices.png" alt="Bluetooth" class="inline"/></p>
<p><img src="../../Device_manager.png" alt="Device Manager" class="inline"/></p>
<p><img src="../../Putty_Configuration.png" alt="PuTTy Configuration" class="inline"/></p>
<p><img src="../../Putty_Configuration_1.png" alt="PuTTy Configuration 1" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md133"></a>
Additional Links</h2>
<ul>
<li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/uart.html#_CPPv416uart_write_bytes11uart_port_tPKv6size_t">Espressif UART Driver API</a></li>
<li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/ledc.html">Espressif LEDC Driver API</a></li>
<li><a href="https://www.gme.cz/data/attachments/dsh.772-148.1.pdf">HC-05 Bluetooth Module</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md134"></a>
Author</h2>
<ul>
<li>Irvin Ortiz<ul>
<li><b>Bachelor of Science in Electrical Engineering with concentration in Computer Engineering</b> </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
      <li class="footer"><a href="https://github.com/jminjares4/Microprocessor-2-Lab-Template"><img class="footer" src="../../university_of_texas_at_el_paso_logo.png" width="104" height="31" alt="doxygen"/></a> v2.0 </li>
    </ul>
  </div>
  </body>
  </html>
  