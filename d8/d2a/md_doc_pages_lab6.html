<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Microprocessor 2 Labs: Lab 6 GPIO, Interrupts, and Queues</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../microprocessor_2_template.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../university_of_texas_at_el_paso_logo-2.png"/></td>
  <td id="projectalign">
   <div id="projectname">Microprocessor 2 Labs<span id="projectnumber">&#160;v2.0</span>
   </div>
   <div id="projectbrief">Microprocessor 2 Lab Documenation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<head>
  <html> 
  <head>
      <!-- ... other metadata & script includes ... -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript">
          DoxygenAwesomeDarkModeToggle.init()
      </script>
  </head>
  <body>
<html>
  <head>
      <!-- ... other metadata & script includes ... -->
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript">
          DoxygenAwesomeFragmentCopyButton.init()
      </script>
  </head>
  <body>
<html>
    <head>
      <a href="https://github.com/jminjares4/Microprocessor-2-Lab-Template" class="github-corner" title="View source on GitHub" target="_blank">
        <svg viewBox="0 0 250 250" width="50" height="50" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    </head>
    <body>
  <!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d8/d2a/md_doc_pages_lab6.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Lab 6 GPIO, Interrupts, and Queues </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md74"></a>
Objective:</h1>
<ul>
<li>Understand how to use interrupt and send data through a queue with <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/freertos.html#queue-api"><code>FreeRTOS Queues</code></a>. In this lab, the main focus will be sending data from a interrupt to a task.</li>
<li>Create a program which uses port interrupts to trigger a task.</li>
<li>The port interrupts must be connected to external push buttons which will trigger the “print_task”.</li>
<li>On the “print_task” your program should print that the interrupt was trigger.<ul>
<li><em><b>Undergrad Bonus</b></em><ul>
<li>Modify the code so the “print_task” prints what port caused the interrupt. +10</li>
</ul>
</li>
<li><em><b>Grad Bonus</b></em><ul>
<li>* Modify the code so the “print_task” prints what port caused the interrupt and turn different <code>LEDs</code> for each interrupt.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md75"></a>
ESP32 Pinout</h2>
<div class="fragment"><div class="line">                                        +-----------------------+</div>
<div class="line">                                        | O      | USB |      O |</div>
<div class="line">                                        |        -------        |</div>
<div class="line">                                    3V3 | [ ]               [ ] | VIN</div>
<div class="line">                                    GND | [ ]               [ ] | GND</div>
<div class="line">    Touch3 / HSPI_CS0 / ADC2_3 / GPIO15 | [ ]               [ ] | GPIO13 / ADC2_4 / HSPI_ID / Touch4</div>
<div class="line">CS / Touch2 / HSPI_WP / ADC2_2 /  GPIO2 | [ ]               [ ] | GPIO12 / ADC2_5 / HSPI_Q / Touch5</div>
<div class="line">     Touch0 / HSPI_HD / ADC2_0 /  GPIO4 | [ ]               [ ] | GPIO14 / ADC2_6 / HSPI_CLK / Touch6</div>
<div class="line">                        U2_RXD / GPIO16 | [ ]               [ ] | GPIO27 / ADC2_7 / Touch7</div>
<div class="line">                        U2_TXD / GPIO17 | [ ]               [ ] | GPIO26 / ADC2_9 / DAC2</div>
<div class="line">                     V_SPI_CS0 /  GPIO5 | [ ]  ___________  [ ] | GPIO25 / ADC2_8 / DAC1</div>
<div class="line">               SCK / V_SPI_CLK / GPIO18 | [ ] |           | [ ] | GPIO33 / ADC1_5 / Touch8 / XTAL32</div>
<div class="line">       U0_CTS / MSIO / V_SPI_Q / GPIO19 | [ ] |           | [ ] | GPIO32 / ADC1_4 / Touch9 / XTAL32</div>
<div class="line">                SDA / V_SPI_HD / GPIO21 | [ ] |           | [ ] | GPIO35 / ADC1_7 </div>
<div class="line">                 CLK2 / U0_RXD /  GPIO3 | [ ] |           | [ ] | GPIO34 / ADC1_6 </div>
<div class="line">                 CLK3 / U0_TXD /  GPIO1 | [ ] |           | [ ] | GPIO39 / ADC1_3 / SensVN </div>
<div class="line">       SCL / U0_RTS / V_SPI_WP / GPIO22 | [ ] |           | [ ] | GPIO36 / ADC1_0 / SensVP </div>
<div class="line">               MOSI / V_SPI_WP / GPIO23 | [ ] |___________| [ ] | EN </div>
<div class="line">                                        |                       |</div>
<div class="line">                                        |  |  |  ____  ____  |  |</div>
<div class="line">                                        |  |  |  |  |  |  |  |  |</div>
<div class="line">                                        |  |__|__|  |__|  |__|  |</div>
<div class="line">                                        | O                   O |</div>
<div class="line">                                        +-----------------------+</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md76"></a>
Example</h2>
<p >The following example is demostration of how to use interrupts in the ESP32. The interrupt routine will toggle the state of the <code>onboard led</code> every time its pressed. There is also another task that will print a message every second. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;sdkconfig.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/task.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/gpio.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define ESP_INTR_FLAG_DEFAULT 0</span></div>
<div class="line"><span class="preprocessor">#define ONBOARD_LED     2</span></div>
<div class="line"><span class="preprocessor">#define GPIO_BUTTON_0   23</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*  ULL is an 8 bytes data type and the GPIO pins need to </span></div>
<div class="line"><span class="comment">    be set to ULL because gpio_config_t pin_bit_mask is an uint64_t. </span></div>
<div class="line"><span class="comment">    The pin_bit_mask is 8 bytes long therefore the GPIO has to be set to the</span></div>
<div class="line"><span class="comment">    corresponding data type by using left bit shift </span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="preprocessor">#define GPIO_OUTPUT_SEL 1ULL &lt;&lt; ONBOARD_LED</span></div>
<div class="line"><span class="preprocessor">#define GPIO_INPUT_SEL  1ULL &lt;&lt; GPIO_BUTTON_0</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> IRAM_ATTR gpio_isr_handler(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    GPIO.out ^= BIT2; <span class="comment">//toggle onboard LED</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> print_task(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Printing data from print_task\n&quot;</span>); <span class="comment">//print message</span></div>
<div class="line">        vTaskDelay(1000/portTICK_RATE_MS); <span class="comment">// 1 second delay</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../de/d45/_lab__6_2main_8c.html#aff73127d1ba9b5a022d9cecadde1da29">setUpGPIO</a>()</div>
<div class="line">{</div>
<div class="line">    gpio_config_t io_conf;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* INPUT */</span> </div>
<div class="line">    io_conf.intr_type = GPIO_INTR_NEGEDGE; <span class="comment">// set as POSEDGE for interrupt </span></div>
<div class="line">    io_conf.mode = GPIO_MODE_INPUT; <span class="comment">// set input </span></div>
<div class="line">    io_conf.pin_bit_mask = GPIO_INPUT_SEL; <span class="comment">// set gpio that will be used for input </span></div>
<div class="line">    io_conf.pull_down_en = 0;  <span class="comment">// disable pull down </span></div>
<div class="line">    io_conf.pull_up_en = 1;  <span class="comment">// enable pull up </span></div>
<div class="line"> </div>
<div class="line">    gpio_config(&amp;io_conf); <span class="comment">// set configuration </span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* OUTPUT */</span></div>
<div class="line">    io_conf.intr_type = GPIO_INTR_DISABLE; <span class="comment">// disable interrupt </span></div>
<div class="line">    io_conf.mode = GPIO_MODE_OUTPUT; <span class="comment">// set as output </span></div>
<div class="line">    io_conf.pin_bit_mask = GPIO_OUTPUT_SEL; <span class="comment">// set gpio that will be used for output </span></div>
<div class="line">    io_conf.pull_down_en = 0 ; <span class="comment">// disable pull down </span></div>
<div class="line">    io_conf.pull_up_en = 0; <span class="comment">// disable pull up </span></div>
<div class="line"> </div>
<div class="line">    gpio_config(&amp;io_conf); <span class="comment">// set configuration</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*  Set ISR to non-share memory </span></div>
<div class="line"><span class="comment">        If this value is 0, it will default to allocating</span></div>
<div class="line"><span class="comment">        a non-shared interrupt of level 1, 2 or 3.</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    gpio_install_isr_service(<a class="code hl_define" href="../../dd/d25/_lab__2_2main_8c.html#af8baf7d9859733667317e58c0ff707d1">ESP_INTR_FLAG_DEFAULT</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Attached GPIO interrupt to interrupt routine and pass an argument */</span></div>
<div class="line">    gpio_isr_handler_add(GPIO_BUTTON_0, gpio_isr_handler, (<span class="keywordtype">void</span> *)GPIO_BUTTON_0);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../dd/d74/_additional___labs_2_lab__10_2main_8c.html#abce06be17fc37d675118a678a8100a36">app_main</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="../../de/d45/_lab__6_2main_8c.html#aff73127d1ba9b5a022d9cecadde1da29">setUpGPIO</a>(); <span class="comment">//set up configuration of the GPIOs </span></div>
<div class="line">    xTaskCreate(&amp;print_task, <span class="stringliteral">&quot;print_task&quot;</span>, 2048, NULL, 10, NULL);</div>
<div class="line">}</div>
<div class="ttc" id="a_additional___labs_2_lab__10_2main_8c_html_abce06be17fc37d675118a678a8100a36"><div class="ttname"><a href="../../dd/d74/_additional___labs_2_lab__10_2main_8c.html#abce06be17fc37d675118a678a8100a36">app_main</a></div><div class="ttdeci">void app_main()</div><div class="ttdef"><b>Definition:</b> main.c:316</div></div>
<div class="ttc" id="a_lab__2_2main_8c_html_af8baf7d9859733667317e58c0ff707d1"><div class="ttname"><a href="../../dd/d25/_lab__2_2main_8c.html#af8baf7d9859733667317e58c0ff707d1">ESP_INTR_FLAG_DEFAULT</a></div><div class="ttdeci">#define ESP_INTR_FLAG_DEFAULT</div><div class="ttdef"><b>Definition:</b> main.c:55</div></div>
<div class="ttc" id="a_lab__6_2main_8c_html_aff73127d1ba9b5a022d9cecadde1da29"><div class="ttname"><a href="../../de/d45/_lab__6_2main_8c.html#aff73127d1ba9b5a022d9cecadde1da29">setUpGPIO</a></div><div class="ttdeci">void setUpGPIO()</div><div class="ttdef"><b>Definition:</b> main.c:71</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
Template Code</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;sdkconfig.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/task.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/queue.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;driver/gpio.h&quot;</span></div>
<div class="line"><span class="preprocessor">#define ESP_INTR_FLAG_DEFAULT 0 </span><span class="comment">//default flag for interrupt </span></div>
<div class="line"><span class="keyword">static</span> xQueueHandle gpio_queue = NULL; <span class="comment">// create a global quue</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> IRAM_ATTR gpio_isr_handler(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//store argument in gpio_num</span></div>
<div class="line">    uint32_t gpio_num = (uint32_t)arg;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//send queue?</span></div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_task(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    uint32_t gpio_num;</div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//wait for queue?</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;GPIO[%d] caused an interrupt\n&quot;</span>, gpio_num);</div>
<div class="line">        vTaskDelay(1000/portTICK_PERIOD_MS);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../de/d45/_lab__6_2main_8c.html#aff73127d1ba9b5a022d9cecadde1da29">setUpGPIO</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* See example for more information */</span></div>
<div class="line">    gpio_config_t io_conf;</div>
<div class="line">    <span class="comment">// INPUT</span></div>
<div class="line">    io_conf.intr_type = ;</div>
<div class="line">    io_conf.mode = ;</div>
<div class="line">    io_conf.pin_bit_mask = ;</div>
<div class="line">    io_conf.pull_down_en = ;</div>
<div class="line">    io_conf.pull_up_en = ;</div>
<div class="line">    gpio_config(&amp;io_conf);</div>
<div class="line">    <span class="comment">// OUTPUT</span></div>
<div class="line">    io_conf.intr_type = ;</div>
<div class="line">    io_conf.mode = ;</div>
<div class="line">    io_conf.pin_bit_mask = ;</div>
<div class="line">    io_conf.pull_down_en = ;</div>
<div class="line">    io_conf.pull_up_en = ;</div>
<div class="line">    gpio_config(&amp;io_conf);</div>
<div class="line">    <span class="comment">// Set ISR</span></div>
<div class="line">    gpio_install_isr_service(<a class="code hl_define" href="../../dd/d25/_lab__2_2main_8c.html#af8baf7d9859733667317e58c0ff707d1">ESP_INTR_FLAG_DEFAULT</a>);</div>
<div class="line">    gpio_isr_handler_add(xxx, gpio_isr_handler, (<span class="keywordtype">void</span> *)xxx);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../dd/d74/_additional___labs_2_lab__10_2main_8c.html#abce06be17fc37d675118a678a8100a36">app_main</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="../../de/d45/_lab__6_2main_8c.html#aff73127d1ba9b5a022d9cecadde1da29">setUpGPIO</a>(); <span class="comment">//set the GPIO and interrupts</span></div>
<div class="line">    gpio_queue = xQueueCreate(10, <span class="keyword">sizeof</span>(uint32_t)); <span class="comment">//create a queue instance</span></div>
<div class="line">    xTaskCreate(&amp;print_task, <span class="stringliteral">&quot;print_task&quot;</span>, 2048, NULL, 10, NULL); <span class="comment">//create a task</span></div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="autotoc_md79"></a>
C helpful functions</h1>
<p >For this lab, we use prior function from Lab 2 that are important for using inputs. In the previous labs we use the function <code>gpio_set_direction(gpio_num_t gpio_num, gpio_mode_t mode)</code> in order to set our inputs and outputs. In this lab, we will use the <code>gpio_config_t</code> which will help us setup the interrupt function. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    uint64_t pin_bit_mask;          </div>
<div class="line">    gpio_mode_t mode;               </div>
<div class="line">    gpio_pullup_t pull_up_en;       </div>
<div class="line">    gpio_pulldown_t pull_down_en;   </div>
<div class="line">    gpio_int_type_t intr_type;      </div>
<div class="line">} gpio_config_t;</div>
</div><!-- fragment --><p> In order to fill in the structure <code>gpio_config_t</code>, each variable is refference to another structure. Inside the <code>uint64_t pin_bin_mask</code> it need a to bit shift the pin number that converts from a int to an unsigned long long by using <code>1ULL &lt;&lt; BUTTON</code>. After tknowing the the next variables have different function structures. For the <code>gpio_mode_t mode</code>, use the listing below in order to set what your button will do ass well if you want to set it up as an output. If you are using the output mode just remember that in order to call an output you need to use <code>GPIO.out = BIT#</code>. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    GPIO_MODE_DISABLE = GPIO_MODE_DEF_DISABLE,                                                         </div>
<div class="line">    GPIO_MODE_INPUT = GPIO_MODE_DEF_INPUT,                                                             </div>
<div class="line">    GPIO_MODE_OUTPUT = GPIO_MODE_DEF_OUTPUT,                                                           </div>
<div class="line">    GPIO_MODE_OUTPUT_OD = ((GPIO_MODE_DEF_OUTPUT) | (GPIO_MODE_DEF_OD)),                               </div>
<div class="line">    GPIO_MODE_INPUT_OUTPUT_OD = ((GPIO_MODE_DEF_INPUT) | (GPIO_MODE_DEF_OUTPUT) | (GPIO_MODE_DEF_OD)), </div>
<div class="line">    GPIO_MODE_INPUT_OUTPUT = ((GPIO_MODE_DEF_INPUT) | (GPIO_MODE_DEF_OUTPUT)),                         </div>
<div class="line">} gpio_mode_t;</div>
</div><!-- fragment --><p> Then in the next two points of the <code>gpio_config_t</code> which are <code>gpio_pulldown_t</code> or <code>gpio_pullup_t</code> is where the button is enable as a pulldown or as a pullup. Finally the last configuration <code>gpio_int_type_t</code>, it decides what type of edge will the button read and the cofiguration is shown below. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    GPIO_INTR_DISABLE = 0,     </div>
<div class="line">    GPIO_INTR_POSEDGE = 1,     </div>
<div class="line">    GPIO_INTR_NEGEDGE = 2,     </div>
<div class="line">    GPIO_INTR_ANYEDGE = 3,     </div>
<div class="line">    GPIO_INTR_LOW_LEVEL = 4,   </div>
<div class="line">    GPIO_INTR_HIGH_LEVEL = 5,  </div>
<div class="line">    GPIO_INTR_MAX,</div>
<div class="line">} gpio_int_type_t;</div>
</div><!-- fragment --><p> Next, you will need to set the interrupt flag into 0 which uses the function : <code>gpio_install_isr_service(int intr_alloc_flags)</code> </p><div class="fragment"><div class="line">esp_err_t gpio_install_isr_service(<span class="keywordtype">int</span> intr_alloc_flags)</div>
</div><!-- fragment --><p> Moreoover, there is a function that allows the interrupt button to enter the <code>static void IRAM_ATTR gpio_isr_handler(void* arg)</code>. In order to enter this function you need to declare using the function <code>gpio_isr_handler_add(gpio_num_t gpio_num, gpio_isr_t isr_handler, void *args)</code>. </p><div class="fragment"><div class="line">esp_err_t gpio_isr_handler_add(gpio_num_t gpio_num, gpio_isr_t isr_handler, <span class="keywordtype">void</span> *args)</div>
</div><!-- fragment --><p> Lastly, there is an very important function was is need to fulfill this lab. We have use queues in the previous labs to send data from one task to another. However, it this lab we need to send data from an interrupt to a task, therefore we will use a special function to send the queue: <b><code>xQueueSendFromISR()</code></b>. Similar to the previous function that we have use to send data with a queue, <code>xQueueSendFromISR</code> is not different with a slight parameter. <code>BaseType_t *pxHigherPriorityTaskWoken</code> parameter set to <em><code>NULL</code></em>. </p><div class="fragment"><div class="line">BaseType_t xQueueSendFromISR</div>
<div class="line">          (</div>
<div class="line">              QueueHandle_t <a class="code hl_variable" href="../../da/de1/_lab__5_2main_8c.html#aa78b6121b7586233293fb6cba5e19206">xQueue</a>,</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">void</span> *pvItemToQueue,</div>
<div class="line">              BaseType_t *pxHigherPriorityTaskWoken</div>
<div class="line">          );</div>
<div class="ttc" id="a_lab__5_2main_8c_html_aa78b6121b7586233293fb6cba5e19206"><div class="ttname"><a href="../../da/de1/_lab__5_2main_8c.html#aa78b6121b7586233293fb6cba5e19206">xQueue</a></div><div class="ttdeci">QueueHandle_t xQueue</div><div class="ttdef"><b>Definition:</b> main.c:72</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md80"></a>
Pull-up and Pull-down Configuration</h2>
<p ><img src="https://user-images.githubusercontent.com/60948298/144836131-96f04e0f-c7f7-443f-b35c-814fb9db4e29.png" alt="button configuation" width="413" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md81"></a>
Additional Links</h2>
<ul>
<li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/gpio.html#">Espressif GPIO Driver API</a></li>
<li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/freertos.html#queue-api">FreeRTOS Queue</a></li>
<li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/freertos.html">FreeRTOS Espressif Documenation</a></li>
<li><a href="https://www.freertos.org/a00125.html">FreeRTOS Documenation</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md82"></a>
Authors</h2>
<ul>
<li><a href="https://github.com/jminjares4"><em><b>Jesus Minjares</b></em></a><ul>
<li><b>Master of Science in Computer Engineering</b> <br  />
 <a href="https://www.linkedin.com/in/jesusminjares/"><img src="https://img.shields.io/badge/LinkedIn-0077B5?style=for-the-badge&amp;logo=linkedin&amp;logoColor=white&amp;style=flat" alt="LinkedIn" class="inline"/></a> <a href="https://github.com/jminjares4"><img src="https://img.shields.io/badge/GitHub-100000?style=for-the-badge&amp;logo=github&amp;logoColor=white&amp;style=flat" alt="GitHub" class="inline"/></a></li>
</ul>
</li>
<li><a href="https://github.com/eabaca2419"><em><b>Erick Baca</b></em></a><ul>
<li><b>Master of Science in Computer Engineering</b> <br  />
 <a href="https://www.linkedin.com/in/erick-baca/"><img src="https://img.shields.io/badge/LinkedIn-0077B5?style=for-the-badge&amp;logo=linkedin&amp;logoColor=white&amp;style=flat" alt="LinkedIn" class="inline"/></a> <a href="https://github.com/eabaca2419"><img src="https://img.shields.io/badge/GitHub-100000?style=for-the-badge&amp;logo=github&amp;logoColor=white&amp;style=flat" alt="GitHub" class="inline"/></a></li>
</ul>
</li>
</ul>
<dl class="section see"><dt>See also</dt><dd><a href="https://github.com/jminjares4/Microprocessor-2-Lab-Template/tree/main/Lab_6">GitHub Lab 6</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
      <li class="footer"><a href="https://github.com/jminjares4/Microprocessor-2-Lab-Template"><img class="footer" src="../../university_of_texas_at_el_paso_logo.png" width="104" height="31" alt="doxygen"/></a> v2.0 </li>
    </ul>
  </div>
  </body>
  </html>
  